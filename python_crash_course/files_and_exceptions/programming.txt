I love programming
I love creating new games
I also love finding meaning in large datasets
I love creating apps that can run in browser

select 
 sto.loading_unit_code as loading_unit,
 listagg(sto.product_code, ', ') within group (order by sto.product_code) as product_codes,
 case
    when substr(prj_host_location_code,5,2) between 04 and 12 then 'IFM1'
    when substr(prj_host_location_code,5,2) between 13 and 21 then 'IFM2'
    when substr(prj_host_location_code,5,2) between 22 and 30 then 'IFM3'
    when substr(prj_host_location_code,5,2) between 31 and 39 then 'IFM4'
    when substr(prj_host_location_code,5,2) between 40 and 48 then 'IFM5'
    when substr(prj_host_location_code,5,2) between 49 and 57 then 'IFM6'
    else 'no ifm'
    end as IFM
 --min(lde.last_location_change) 
 --listagg(to_char(lde.LAST_LOCATION_CHANGE, 'YYYY-MM-DD'), ', ') within group (order by lde.LAST_LOCATION_CHANGE asc) as last_location_changes
from v_stock sto
join loading_unit lou on lou.loading_unit_id = sto.loading_unit_id
join location loc on loc.location_id = lou.location_id
join station sta on sta.station_id = loc.station_id
join station sta_stock_area on sta_stock_area.station_id = sto.stock_area_station_id
join loading_unit_event lde on lde.LOADING_UNIT_CODE = lou.LOADING_UNIT_CODE
where sta_stock_area.STATION_NAME like '%OSRM01%'
 and lde.LAST_LOCATION_CHANGE <= ADD_MONTHS(SYSDATE, -12)
 --and rownum < 10
 --and touched_2 = 'N'
group by  sto.loading_unit_code,
    case
    when substr(prj_host_location_code,5,2) between 04 and 12 then 'IFM1'
    when substr(prj_host_location_code,5,2) between 13 and 21 then 'IFM2'
    when substr(prj_host_location_code,5,2) between 22 and 30 then 'IFM3'
    when substr(prj_host_location_code,5,2) between 31 and 39 then 'IFM4'
    when substr(prj_host_location_code,5,2) between 40 and 48 then 'IFM5'
    when substr(prj_host_location_code,5,2) between 49 and 57 then 'IFM6'
    else 'no ifm'
    end
order by sto.loading_unit_code;